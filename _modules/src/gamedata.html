
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.gamedata &#8212; Spireblight 0.6 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=ec806d2c"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/src/gamedata';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Spireblight 0.6 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../modules.html">
    Full Spireblight API
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Spireblight/Spireblight" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../modules.html">
    Full Spireblight API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Spireblight/Spireblight" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">src.gamedata</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for src.gamedata</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">HTTPForbidden</span><span class="p">,</span> <span class="n">HTTPNotImplemented</span><span class="p">,</span> <span class="n">HTTPNotFound</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.typehints</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_for_slaytabase</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="n">plt</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mpld3</span><span class="w"> </span><span class="kn">import</span> <span class="n">fig_to_html</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="n">fig_to_html</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.nameinternal</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_event</span><span class="p">,</span> <span class="n">get_relic_stats</span><span class="p">,</span> <span class="n">get_run_mod</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">get_card</span><span class="p">,</span> <span class="n">Card</span><span class="p">,</span> <span class="n">SingleCard</span><span class="p">,</span> <span class="n">Relic</span><span class="p">,</span> <span class="n">Potion</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.sts_profile</span><span class="w"> </span><span class="kn">import</span> <span class="n">Profile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">src.runs</span><span class="w"> </span><span class="kn">import</span> <span class="n">StreakInfo</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ShopContents&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KeysObtained&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RelicData&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CardData&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BottleRelic&quot;</span><span class="p">,</span>

    <span class="s2">&quot;FileParser&quot;</span><span class="p">,</span>

    <span class="s2">&quot;BaseNode&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NeowBonus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NodeData&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EncounterBase&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NormalEncounter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EventEncounter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Treasure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EventTreasure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EliteEncounter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EventElite&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EmptyEvent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AmbiguousEvent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Event&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EventFight&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Colosseum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Merchant&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EventMerchant&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Courier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Empty&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SWF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Campfire&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Boss&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BossChest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Act4Transition&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Victory&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># XXX Make sure to remove private member access from outside the class</span>
<span class="c1"># search for #PRIV# in this file for places that need modified</span>
<span class="c1"># put all of damage_taken, max_hp_{gained,lost} on the base class</span>

<div class="viewcode-block" id="BaseNode">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseNode</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This the common base class for all path nodes, including Neow.</span>

<span class="sd">    This provides basic utility functions that subclasses may use.</span>

<span class="sd">    This also has abstract methods and properties that need to be overridden.</span>

<span class="sd">    Subclasses can - and should - implement their own `get_description` method.</span>
<span class="sd">    This takes one argument, type `collections.defaultdict[int, list[str]]`,</span>
<span class="sd">    and should modify that mapping in-place. Returning any non-None value will</span>
<span class="sd">    raise an error. The method should **NOT** attempt to call the superclass</span>
<span class="sd">    version of it with `super()`. BaseNode&#39;s `description` method walks through</span>
<span class="sd">    the entire superclass tree, including third-party classes, in Method</span>
<span class="sd">    Resolution Order, and calls each existing `get_description` method in each</span>
<span class="sd">    class. Failure to implement this method in a direct subclass will raise an</span>
<span class="sd">    error, though additional classes in the MRO without one will pass silently.</span>

<span class="sd">    Built-in index keys all use even numbers. Result will be joined together</span>
<span class="sd">    with newlines, and returned in ascending order. Custom code should only add</span>
<span class="sd">    data to odd indices. Ranges are provided here; refer to the relevant</span>
<span class="sd">    subclass for details. Calling order between various methods is not</span>
<span class="sd">    guaranteed - appending to a key already used may have unexpected results.</span>

<span class="sd">    | 0     - Basic stuff; only for things that all nodes share</span>
<span class="sd">    | 2     - Event-specific combat setup</span>
<span class="sd">    | 4     - Combat results (damage taken, turns elapsed, etc.)</span>
<span class="sd">    | 6     - Unique values (key obtained, campfire option, etc.)</span>
<span class="sd">    | 8     - Neow bonus</span>
<span class="sd">    | 10-20 - Potion usage data</span>
<span class="sd">    | 30-36 - Relic obtention data</span>
<span class="sd">    | 40-62 - Event results</span>
<span class="sd">    | 70-78 - Shop contents</span>
<span class="sd">    | 100+  - Special stuff; reserved for bugged or modded content</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">room_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>         <span class="c1">#: The display name of map nodes.</span>
    <span class="n">end_of_act</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>    <span class="c1">#: Whether to add a newline after this map node.</span>

    <span class="c1"># the following are handled differently in each branch</span>
    <span class="c1"># as such, we only tell the type checkers what they are</span>
    <span class="c1"># if a subclass does not implement these, it is a bug</span>

    
    <span class="n">current_hp</span><span class="p">:</span> <span class="nb">int</span>             <span class="c1">#: The current HP when exiting the node.</span>
    <span class="n">max_hp</span><span class="p">:</span> <span class="nb">int</span>                 <span class="c1">#: The max HP when exiting the node.</span>
    <span class="n">gold</span><span class="p">:</span> <span class="nb">int</span>                   <span class="c1">#: The gold when exiting the node.</span>

    <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span>                  <span class="c1">#: The floor associated with this node.</span>

    <span class="n">card_count</span><span class="p">:</span> <span class="nb">int</span>             <span class="c1">#: How many cards we currently have.</span>
    <span class="n">relic_count</span><span class="p">:</span> <span class="nb">int</span>            <span class="c1">#: How many relics we currently have.</span>
    <span class="n">potion_count</span><span class="p">:</span> <span class="nb">int</span>           <span class="c1">#: How many potions we currently have.</span>
    <span class="n">fights_count</span><span class="p">:</span> <span class="nb">int</span>           <span class="c1">#: How many fights were fought so far this run.</span>
    <span class="n">turns_count</span><span class="p">:</span> <span class="nb">int</span>            <span class="c1">#: How many turns passed so far this run.</span>

    <span class="n">floor_time</span><span class="p">:</span> <span class="nb">int</span>             <span class="c1">#: How much time, in seconds, we spent on this floor.</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a new BaseNode instance.</span>

<span class="sd">        :param parser: The run or save this node is in</span>
<span class="sd">        :type parser: FileParser</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floor_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Potions obtained on this node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">potions</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">picked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards picked this floor.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">card_choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">skipped</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards skipped this floor.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">card_choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_obtained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards obtained outside of a card reward this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards that were removed this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_transformed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards that were transformed away this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_upgraded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards that were upgraded this floor, before the upgrade.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Relics obtained on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">relics_obtained</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Relics lost on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">used_potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Potions used on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">potions_use</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_from_alchemize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Potions obtained through Alchemize on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">potions_alchemize</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_from_entropic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Potions obtained through Entropic Brew on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">potions_entropic</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">discarded_potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Potions which were mercilessly discarded on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">potions_discarded</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_potions_received</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All potions which were received on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_alchemize</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_entropic</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_potions_dropped</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All potions which were used or discarded this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_potions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">discarded_potions</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">skipped_relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of relics that were offered but skipped here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">skipped_rewards</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">skipped_potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of potions that were offered but skipped here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">skipped_rewards</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name to display for the node.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="BaseNode.card_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.card_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">card_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many cards were added or removed on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span><span class="p">)</span></div>


<div class="viewcode-block" id="BaseNode.relic_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.relic_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">relic_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many relics were gained or lost on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relics_lost</span><span class="p">)</span></div>


<div class="viewcode-block" id="BaseNode.potion_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.potion_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">potion_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many potions were obtained, used, or discarded on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_potions_received</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_potions_dropped</span><span class="p">)</span></div>


<div class="viewcode-block" id="BaseNode.fights_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.fights_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fights_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many fights were fought on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="BaseNode.turns_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.turns_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">turns_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many turns were spent on this floor.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="BaseNode.description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a newline-separated description for the current node.</span>

<span class="sd">        Refer to BaseNode&#39;s docstring for implementation details.&quot;&quot;&quot;</span>

        <span class="c1"># TODO: Move away from numbers and use Enums</span>

        <span class="n">to_append</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_description</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># support multi-classing if you&#39;re Emily Axford</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># returned something</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.get_description()&#39; returned a non-None value.&quot;</span><span class="p">)</span>
            <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">to_append</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">:=</span> <span class="nb">min</span><span class="p">(</span><span class="n">to_append</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> used negative index </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> (positive values only)&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> did not use a number-like type&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_append</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">desc</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">final</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">final</span><span class="p">)</span></div>


<div class="viewcode-block" id="BaseNode.escaped_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.escaped_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">escaped_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a description suitable for HTML pages.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">)</span></div>


    <span class="c1"># Every subclass must implement this method, and NOT call this one</span>

<div class="viewcode-block" id="BaseNode.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BaseNode.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add each individual node&#39;s description, as needed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_type</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">room_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_hp</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hp</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gold</span><span class="si">}</span><span class="s2"> gold&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="NeowBonus">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NeowBonus</span><span class="p">(</span><span class="n">BaseNode</span><span class="p">):</span>

    <span class="n">all_bonuses</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;THREE_CARDS&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose one of three cards to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RANDOM_COLORLESS&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose an uncommon Colorless card to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RANDOM_COMMON_RELIC&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain a random common relic.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;REMOVE_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Remove a card.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TRANSFORM_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Transform a card.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;UPGRADE_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Upgrade a card.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;THREE_ENEMY_KILL&quot;</span><span class="p">:</span> <span class="s2">&quot;Enemies in the first three combats have 1 HP.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;THREE_SMALL_POTIONS&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain 3 random potions.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TEN_PERCENT_HP_BONUS&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain 10% Max HP.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONE_RANDOM_RARE_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain a random Rare card.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HUNDRED_GOLD&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain 100 gold.&quot;</span><span class="p">,</span>

        <span class="s2">&quot;TWO_FIFTY_GOLD&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain 250 gold.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TWENTY_PERCENT_HP_BONUS&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain 20% Max HP.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RANDOM_COLORLESS_2&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose a Rare colorless card to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;THREE_RARE_CARDS&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose a Rare card to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;REMOVE_TWO&quot;</span><span class="p">:</span> <span class="s2">&quot;Remove two cards.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TRANSFORM_TWO_CARDS&quot;</span><span class="p">:</span> <span class="s2">&quot;Transform two cards.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONE_RARE_RELIC&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain a random Rare relic.&quot;</span><span class="p">,</span>

        <span class="s2">&quot;BOSS_RELIC&quot;</span><span class="p">:</span> <span class="s2">&quot;Lose your starter relic. Obtain a random Boss relic.&quot;</span><span class="p">,</span>

        <span class="c1"># more Neow</span>

        <span class="s2">&quot;CHOOSE_OTHER_CHAR_RANDOM_COMMON_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose a common card from another character to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CHOOSE_OTHER_CHAR_RANDOM_UNCOMMON_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose an uncommon card from another character to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CHOOSE_OTHER_CHAR_RANDOM_RARE_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose a rare card from another character to obtain.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAIN_RANDOM_SHOP_RELIC&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain a random Shop relic.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAIN_POTION_SLOT&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain a potion slot.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAIN_TWO_POTION_SLOTS&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain two potions slots.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAIN_TWO_RANDOM_COMMON_RELICS&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain two random common relics.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAIN_UNCOMMON_RELIC&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain a random uncommon relic.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;THREE_BIG_POTIONS&quot;</span><span class="p">:</span> <span class="s2">&quot;Obtain three random potions.&quot;</span><span class="p">,</span>

        <span class="s2">&quot;SWAP_MEMBERSHIP_COURIER&quot;</span><span class="p">:</span> <span class="s2">&quot;Take a small loan... of a million gold.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">all_costs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CURSE&quot;</span><span class="p">:</span> <span class="s2">&quot;Gain a curse.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NO_GOLD&quot;</span><span class="p">:</span> <span class="s2">&quot;Lose all gold.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TEN_PERCENT_HP_LOSS&quot;</span><span class="p">:</span> <span class="s2">&quot;Lose 10% Max HP.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PERCENT_DAMAGE&quot;</span><span class="p">:</span> <span class="s2">&quot;Take damage.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TWO_STARTER_CARDS&quot;</span><span class="p">:</span> <span class="s2">&quot;Add two starter cards.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONE_STARTER_CARD&quot;</span><span class="p">:</span> <span class="s2">&quot;Add a starter card.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">floor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Neow bonus&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">choice_made</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether a Neow bonus was picked yet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">boon_picked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Which Neow bonus was picked, in a human-readable format.&quot;&quot;&quot;</span>
        <span class="n">bonus</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span>
        <span class="k">if</span> <span class="n">cost</span> <span class="o">==</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_bonuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bonus</span><span class="p">,</span> <span class="n">bonus</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_costs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_bonuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bonus</span><span class="p">,</span><span class="w"> </span><span class="n">bonus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">boons_skipped</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Which Neow bonuses were skipped, in a human-readable format.&quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">bonuses</span><span class="p">,</span> <span class="n">costs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bonuses</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">costs</span><span class="p">:</span>
            <span class="k">yield</span> <span class="s2">&quot;&lt;Could not fetch data&gt;&quot;</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">costs</span><span class="p">,</span> <span class="n">bonuses</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;NONE&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_bonuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_costs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">all_bonuses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_obtained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_obtained</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cardsObtained&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_removed</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cardsRemoved&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_transformed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_transformed</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cardsTransformed&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_upgraded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_upgraded</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cardsUpgraded&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">relics</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relicsObtained&#39;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_taken</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much damage we took here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;damageTaken&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp_gained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much max HP we gained here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxHpGained&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much max HP we lost here.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxHpLost&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_hp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return how much HP the run had before entering floor 1 in a (current, max) tuple.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">character</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">character</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;Snecko&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">85</span>
            <span class="k">case</span> <span class="s2">&quot;Ironclad&quot;</span> <span class="o">|</span> <span class="s2">&quot;Guardian&quot;</span> <span class="o">|</span> <span class="s2">&quot;Champ&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">80</span>
            <span class="k">case</span> <span class="s2">&quot;Defect&quot;</span> <span class="o">|</span> <span class="s2">&quot;Hermit&quot;</span> <span class="o">|</span> <span class="s2">&quot;Blade Gunner&quot;</span> <span class="o">|</span> <span class="s2">&quot;Packmaster&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">75</span>
            <span class="k">case</span> <span class="s2">&quot;Watcher&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">72</span>
            <span class="k">case</span> <span class="s2">&quot;Silent&quot;</span> <span class="o">|</span> <span class="s2">&quot;Bronze Automaton&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">70</span>
            <span class="k">case</span> <span class="s2">&quot;Hexaghost&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">66</span>
            <span class="k">case</span> <span class="s2">&quot;Slime Boss&quot;</span> <span class="o">|</span> <span class="s2">&quot;Collector&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">65</span>
            <span class="k">case</span> <span class="s2">&quot;Gremlin Gang&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="k">case</span> <span class="n">a</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">76</span> <span class="c1"># idk man, seems fine?</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ascension_level</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span> <span class="c1"># lower max HP</span>
            <span class="n">base</span> <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">base</span><span class="o">/</span><span class="mi">16</span><span class="p">)</span>

        <span class="n">bonus</span> <span class="o">=</span> <span class="n">base</span> <span class="o">//</span> <span class="mi">10</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="n">base</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ascension_level</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span> <span class="c1"># take damage</span>
            <span class="n">cur</span> <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">cur</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">cur</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_taken</span>
            <span class="n">cur</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span>
            <span class="n">base</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_lost</span>
            <span class="n">base</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s2">&quot;TEN_PERCENT_HP_LOSS&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">-=</span> <span class="n">bonus</span>
                <span class="k">if</span> <span class="n">cur</span> <span class="o">&gt;</span> <span class="n">base</span><span class="p">:</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">base</span>
            <span class="k">case</span> <span class="s2">&quot;PERCENT_DAMAGE&quot;</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">-=</span> <span class="p">(</span><span class="n">cur</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s2">&quot;TEN_PERCENT_HP_BONUS&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">+=</span> <span class="n">bonus</span>
                <span class="n">cur</span> <span class="o">+=</span> <span class="n">bonus</span>
            <span class="k">case</span> <span class="s2">&quot;TWENTY_PERCENT_HP_BONUS&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bonus</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">cur</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bonus</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_hp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_hp</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_hp</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gold</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="mi">99</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">base</span> <span class="o">+=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;goldGained&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;goldLost&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;Old Coin&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;relicsObtained&quot;</span><span class="p">]:</span>
                <span class="n">base</span> <span class="o">+=</span> <span class="mi">300</span>
            <span class="k">return</span> <span class="n">base</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NO_GOLD&quot;</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">case</span> <span class="s2">&quot;HUNDRED_GOLD&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">+=</span> <span class="mi">100</span>
            <span class="k">case</span> <span class="s2">&quot;TWO_FIFTY_GOLD&quot;</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">+=</span> <span class="mi">250</span>
            <span class="k">case</span> <span class="s2">&quot;ONE_RARE_RELIC&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">relics_bare</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Old Coin&quot;</span><span class="p">:</span> <span class="c1"># this can break if N&#39;loth is involved</span>
                    <span class="n">base</span> <span class="o">+=</span> <span class="mi">300</span>

        <span class="k">return</span> <span class="n">base</span>

<div class="viewcode-block" id="NeowBonus.get_cards">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.get_cards">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cards we begin the run with.&quot;&quot;&quot;</span>
        <span class="n">cards</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ascension_level</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;AscendersBane&quot;</span><span class="p">)</span>

        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">character</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;Ironclad&quot;</span><span class="p">:</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Strike_R&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Defend_R&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Bash&quot;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;Silent&quot;</span><span class="p">:</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Strike_G&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Defend_G&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Neutralize&quot;</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Survivor&quot;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;Defect&quot;</span><span class="p">:</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Strike_B&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Defend_B&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Zap&quot;</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dualcast&quot;</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;Watcher&quot;</span><span class="p">:</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Strike_P&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">&quot;Defend_P&quot;</span><span class="p">,)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Vigilance&quot;</span><span class="p">)</span>
                <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Eruption&quot;</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I don&#39;t know how to handle </span><span class="si">{</span><span class="n">a</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">cards</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_card</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">:</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">:</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_upgraded</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">cards</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">cards</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">upgrades</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cards</span></div>


    <span class="c1"># options 1 &amp; 2</span>

<div class="viewcode-block" id="NeowBonus.bonus_THREE_CARDS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_THREE_CARDS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_THREE_CARDS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a draft of three cards, colorless or otherwise.</span>

<span class="sd">        :raises ValueError: If no matching card choice can be found</span>
<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;picked </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> over </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;were offered </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">)</span><span class="si">}</span><span class="s2"> but skipped them all&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;That is not the right bonus??&quot;</span><span class="p">)</span></div>


    <span class="n">bonus_RANDOM_COLORLESS</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>

<div class="viewcode-block" id="NeowBonus.bonus_RANDOM_COMMON_RELIC">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_RANDOM_COMMON_RELIC">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_RANDOM_COMMON_RELIC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a random common relic.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;picked a random Common relic&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_REMOVE_CARD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_REMOVE_CARD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_REMOVE_CARD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a card removal.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;removed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;removed a card&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_TRANSFORM_CARD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_TRANSFORM_CARD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_TRANSFORM_CARD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a card transform.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;transformed </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;transformed a card&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_UPGRADE_CARD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_UPGRADE_CARD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_UPGRADE_CARD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a card upgrade.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_upgraded</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;upgraded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_upgraded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;upgraded a card&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_THREE_ENEMY_KILL">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_THREE_ENEMY_KILL">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_THREE_ENEMY_KILL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is Neow&#39;s Lament.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;got Neow&#39;s Lament to get three fights with enemies having 1 HP&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_THREE_SMALL_POTIONS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_THREE_SMALL_POTIONS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_THREE_SMALL_POTIONS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is three potions.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_potions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;were offered </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">skipped_potions</span><span class="p">)</span><span class="si">}</span><span class="s2"> and skipped all of them... for some reason&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">)</span><span class="si">}</span><span class="s2">, and skipped </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">skipped_potions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_TEN_PERCENT_HP_BONUS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_TEN_PERCENT_HP_BONUS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_TEN_PERCENT_HP_BONUS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is +10% Max HP.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;gained </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span><span class="si">}</span><span class="s2"> Max HP&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;gained 10% Max HP&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_ONE_RANDOM_RARE_CARD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_ONE_RANDOM_RARE_CARD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_ONE_RANDOM_RARE_CARD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a random rare card.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;picked a random Rare card, and got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;picked a random Rare card&quot;</span></div>


    <span class="c1"># option 3</span>

<div class="viewcode-block" id="NeowBonus.bonus_TWO_FIFTY_GOLD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_TWO_FIFTY_GOLD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_TWO_FIFTY_GOLD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is 250 gold.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;got 250 gold&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_TWENTY_PERCENT_HP_BONUS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_TWENTY_PERCENT_HP_BONUS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_TWENTY_PERCENT_HP_BONUS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is +20% Max HP.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;gained </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hp_gained</span><span class="si">}</span><span class="s2"> Max HP&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;gained 20% Max HP&quot;</span></div>


    <span class="n">bonus_RANDOM_COLORLESS_2</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>
    <span class="n">bonus_THREE_RARE_CARDS</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>

<div class="viewcode-block" id="NeowBonus.bonus_REMOVE_TWO">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_REMOVE_TWO">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_REMOVE_TWO</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is two card removals.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;removed </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;removed two cards&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_TRANSFORM_TWO_CARDS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_TRANSFORM_TWO_CARDS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_TRANSFORM_TWO_CARDS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is two card transforms.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span><span class="p">:</span>
            <span class="c1"># in case the cost is &quot;gain a curse&quot;, the curse will be the first item. this guarantees we only get the last two cards</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;transformed </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">cards_transformed</span><span class="p">)</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;transformed two cards&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.bonus_ONE_RARE_RELIC">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_ONE_RARE_RELIC">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_ONE_RARE_RELIC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is a random rare relic.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;picked a random Rare relic and got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;obtained a random Rare relic&quot;</span></div>


    <span class="c1"># option 4</span>

<div class="viewcode-block" id="NeowBonus.bonus_BOSS_RELIC">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.bonus_BOSS_RELIC">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bonus_BOSS_RELIC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the bonus is swap your starter relic for a random boss relic.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;swapped our starter relic for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;swapped our starter relic for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">relics_bare</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># N&#39;loth can mess with this</span></div>


    <span class="c1"># more Neow mod</span>

    <span class="n">bonus_CHOOSE_OTHER_CHAR_RANDOM_COMMON_CARD</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>
    <span class="n">bonus_CHOOSE_OTHER_CHAR_RANDOM_UNCOMMON_CARD</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>
    <span class="n">bonus_CHOOSE_OTHER_CHAR_RANDOM_RARE_CARD</span> <span class="o">=</span> <span class="n">bonus_THREE_CARDS</span>

    <span class="c1"># costs for option 3</span>

<div class="viewcode-block" id="NeowBonus.cost_CURSE">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.cost_CURSE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cost_CURSE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the cost is gain a random curse.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;got cursed with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cards_obtained</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;got a random curse&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.cost_NO_GOLD">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.cost_NO_GOLD">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cost_NO_GOLD</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the cost is lose all gold.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;lost all gold&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.cost_TEN_PERCENT_HP_LOSS">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.cost_TEN_PERCENT_HP_LOSS">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cost_TEN_PERCENT_HP_LOSS</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the cost is -10% Max HP.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_hp_lost</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;lost </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_hp_lost</span><span class="si">}</span><span class="s2"> Max HP&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;lost 10% Max HP&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.cost_PERCENT_DAMAGE">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.cost_PERCENT_DAMAGE">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cost_PERCENT_DAMAGE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call if the cost is ~30% current HP loss.</span>

<span class="sd">        :return: Human-readable string to be used by :meth:`as_str`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_taken</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;took </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_taken</span><span class="si">}</span><span class="s2"> damage&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;took damage (current HP / 10, rounded down, * 3)&quot;</span></div>


<div class="viewcode-block" id="NeowBonus.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_str</span><span class="p">())</span></div>


<div class="viewcode-block" id="NeowBonus.as_str">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.as_str">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Neow bonus information.</span>

<span class="sd">        :return: Human-readable string of the cost and bonus.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bonus</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span>
        <span class="n">neg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;cost_</span><span class="si">{</span><span class="n">cost</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;bonus_</span><span class="si">{</span><span class="n">bonus</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;No option picked/option unknown&gt;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">neg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;We </span><span class="si">{</span><span class="n">pos</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;We </span><span class="si">{</span><span class="n">neg</span><span class="p">()</span><span class="si">}</span><span class="s2">, and then </span><span class="si">{</span><span class="n">pos</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&lt;Unknown option&gt;&quot;</span>

        <span class="k">return</span> <span class="n">msg</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether we support the bonus gotten.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;bonus_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CardData</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cards we have, in an iterable format.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cards</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">CardData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

<div class="viewcode-block" id="NeowBonus.card_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.card_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">card_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">card_delta</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">character</span> <span class="o">==</span> <span class="s2">&quot;Silent&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ascension_level</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">bonus</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span>

        <span class="k">if</span> <span class="n">cost</span> <span class="o">==</span> <span class="s2">&quot;CURSE&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">match</span> <span class="n">bonus</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;REMOVE_CARD&quot;</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">case</span> <span class="s2">&quot;REMOVE_TWO&quot;</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">-=</span> <span class="mi">2</span>
            <span class="k">case</span> <span class="s2">&quot;ONE_RANDOM_RARE_CARD&quot;</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">num</span></div>


<div class="viewcode-block" id="NeowBonus.relic_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NeowBonus.relic_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">relic_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="c1"># does not handle calling bell</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_neow_picked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;THREE_ENEMY_KILL&quot;</span><span class="p">,</span> <span class="s2">&quot;ONE_RARE_RELIC&quot;</span><span class="p">,</span> <span class="s2">&quot;RANDOM_COMMON_RELIC&quot;</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">num</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">card_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many cards we currently have.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">card_delta</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relic_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many relics we currently have.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic_delta</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potion_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many potions we currently have.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">potion_delta</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fights_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many fights were fought so far this run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">turns_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many turns passed so far this run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span></div>


<span class="n">_chars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;SLIMEBOUND&quot;</span><span class="p">:</span> <span class="s2">&quot;Slime Boss&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GREMLIN&quot;</span><span class="p">:</span> <span class="s2">&quot;Gremlin Gang&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THE_SPIRIT&quot;</span><span class="p">:</span> <span class="s2">&quot;Hexaghost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;THE_AUTOMATON&quot;</span><span class="p">:</span> <span class="s2">&quot;Bronze Automaton&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_enemies</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># Downfall bosses</span>
    <span class="s2">&quot;IC_STATUS_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Status Ironclad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SI_POISON_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Poison Silent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DF_ARCHETYPE_STREAMLINE&quot;</span><span class="p">:</span> <span class="s2">&quot;0-cost Defect&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WA_ARCHETYPE_RETAIN&quot;</span><span class="p">:</span> <span class="s2">&quot;Retain Watcher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HERMIT_SHARPSHOOTER_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Deadeye Hermit&quot;</span><span class="p">,</span>

    <span class="s2">&quot;IC_MUSHROOM_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Reaper Ironclad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SI_MIRROR_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;After Image Silent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DF_ARCHETYPE_CLAW&quot;</span><span class="p">:</span> <span class="s2">&quot;Claw Defect&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WA_ARCHETYPE_CALM&quot;</span><span class="p">:</span> <span class="s2">&quot;Blasphemy Watcher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HERMIT_WHEEL_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Rotating Cards Hermit&quot;</span><span class="p">,</span>

    <span class="s2">&quot;IC_BLOCK_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Barricade Ironclad&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SI_SHIV_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Shiv Silent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DF_ARCHETYPE_ORBS&quot;</span><span class="p">:</span> <span class="s2">&quot;Orb Defect&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WA_ARCHETYPE_DIVINITY&quot;</span><span class="p">:</span> <span class="s2">&quot;Mantra Watcher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HERMIT_DOOMSDAY_ARCHETYPE&quot;</span><span class="p">:</span> <span class="s2">&quot;Doomsday Hermit&quot;</span><span class="p">,</span>

    <span class="s2">&quot;downfall:NeowBoss&quot;</span><span class="p">:</span> <span class="s2">&quot;The heroes, Returned&quot;</span><span class="p">,</span>
    <span class="s2">&quot;downfall:NeowBossFinal&quot;</span><span class="p">:</span> <span class="s2">&quot;Neow, Goddess of Life&quot;</span><span class="p">,</span>
<span class="p">}</span>

<div class="viewcode-block" id="ShopContents">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.ShopContents">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ShopContents</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contains one floor&#39;s shop contents.</span>

<span class="sd">    This can be used either for contents or purchases.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ShopContents.add_card">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.ShopContents.add_card">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a card to this floor&#39;s contents.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span></div>


<div class="viewcode-block" id="ShopContents.add_relic">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.ShopContents.add_relic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_relic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relic</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a relic to this floor&#39;s contents.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">relic</span><span class="p">))</span></div>


<div class="viewcode-block" id="ShopContents.add_potion">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.ShopContents.add_potion">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_potion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">potion</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a potion to this floor&#39;s contents.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">potion</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="FileParser">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileParser</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="n">_variables_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;current_hp&quot;</span><span class="p">:</span> <span class="s2">&quot;Current HP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_hp&quot;</span><span class="p">:</span> <span class="s2">&quot;Max HP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gold&quot;</span><span class="p">:</span> <span class="s2">&quot;Gold&quot;</span><span class="p">,</span>
        <span class="s2">&quot;floor_time&quot;</span><span class="p">:</span> <span class="s2">&quot;Time spent in the floor (seconds)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;card_count&quot;</span><span class="p">:</span> <span class="s2">&quot;Cards in the deck&quot;</span><span class="p">,</span>
        <span class="s2">&quot;relic_count&quot;</span><span class="p">:</span> <span class="s2">&quot;Relics&quot;</span><span class="p">,</span>
        <span class="s2">&quot;potion_count&quot;</span><span class="p">:</span> <span class="s2">&quot;Potions&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_graph_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;embed&quot;</span><span class="p">:</span> <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;image/png&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_potion_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;use&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;PotionUseLog&quot;</span><span class="p">,</span> <span class="s2">&quot;potion_use_per_floor&quot;</span><span class="p">),</span>
        <span class="s2">&quot;alchemize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;potionsObtainedAlchemizeLog&quot;</span><span class="p">,</span> <span class="s2">&quot;potions_obtained_alchemize&quot;</span><span class="p">),</span>
        <span class="s2">&quot;entropic&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;potionsObtainedEntropicBrewLog&quot;</span><span class="p">,</span> <span class="s2">&quot;potions_obtained_entropic_brew&quot;</span><span class="p">),</span>
        <span class="s2">&quot;discarded&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;PotionDiscardLog&quot;</span><span class="p">,</span> <span class="s2">&quot;potion_discard_per_floor&quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>            <span class="c1">#: String to prepend to most data access.</span>
    <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>          <span class="c1">#: Whether the run is over.</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span> <span class="o">=</span> <span class="n">NeowBonus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span> <span class="c1"># this lets us do on-the-fly debugging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_character</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_boss_chest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="s2">&quot;boss_chest_iter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;boss_chest_iter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;boss_relics&quot;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span> <span class="c1"># with a savefile, it&#39;s possible to try to get the same floor twice, which will the last one</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;boss_chest_iter&quot;</span><span class="p">])</span> <span class="c1"># type: ignore</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;boss_relics&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;view&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span> <span class="ow">or</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Needs &#39;view&#39; and &#39;type&#39; params&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPNotImplemented</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Display type </span><span class="si">{</span><span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is undefined&quot;</span><span class="p">)</span>

        <span class="n">graph_type</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="n">display_type</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s2">&quot;view&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>

        <span class="n">to_cache</span> <span class="o">=</span> <span class="p">(</span><span class="n">graph_type</span><span class="p">,</span> <span class="n">display_type</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_cache</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">[</span><span class="n">to_cache</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_graph</span><span class="p">(</span><span class="n">graph_type</span><span class="p">,</span> <span class="n">display_type</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">allow_private</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPNotFound</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">[</span><span class="n">to_cache</span><span class="p">],</span> <span class="n">content_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_types</span><span class="p">[</span><span class="n">display_type</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Display type </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> is undefined&quot;</span><span class="p">)</span>
        <span class="n">to_cache</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">label</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">to_cache</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">[</span><span class="n">to_cache</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_graph</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">allow_private</span><span class="o">=</span><span class="n">allow_private</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph_cache</span><span class="p">[</span><span class="n">to_cache</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">display_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allow_private</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;matplotlib is not installed, graphs cannot be used&quot;</span><span class="p">)</span>

        <span class="n">totals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ends</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">floors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_private</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot access private attribute </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">totals</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variables_map</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph parameter </span><span class="si">{</span><span class="n">arg</span><span class="si">!r}</span><span class="s2"> may not be properly handled.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">totals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">floors</span><span class="p">:</span>
                    <span class="n">floors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="n">floors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">end_of_act</span><span class="p">:</span>
                <span class="n">ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">totals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot call function </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> that requires parameters.&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">+</span> <span class="mi">0</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot use non-integer </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> for graphs.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">match</span> <span class="n">graph_type</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span>
            <span class="k">case</span> <span class="s2">&quot;scatter&quot;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span>
            <span class="k">case</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span>
            <span class="k">case</span> <span class="s2">&quot;stem&quot;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">stem</span>
            <span class="k">case</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not understand graph type </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">display_type</span> <span class="o">!=</span> <span class="s2">&quot;embed&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ends</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">totals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">func</span><span class="p">(</span><span class="n">floors</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Floor&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">totals</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_variables_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># doesn&#39;t appear to work with mpld3</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">display_type</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;embed&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fig_to_html</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mpld3 isn&#39;t installed, cannot embed graphs. Use &#39;image&#39; display type&quot;</span><span class="p">)</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">fig_to_html</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span>

            <span class="k">case</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The last or latest floor.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save time, as UTC.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">timedelta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time delta, semantics depending on the subclass.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">profile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Profile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The profile this run is played on.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">character_streak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreakInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The run position in the character streak.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotating_streak</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreakInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The run position in the rotating streak.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_neow_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Neow Bonus data. For internal use only.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_neow_picked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Neow bonus and cost picked. For internal use only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;neow_bonus&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;neow_cost&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The display name to be used on the website.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">skipped_rewards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">RelicRewards</span><span class="p">,</span> <span class="n">PotionRewards</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All of the skipped relics and potions this run.&quot;&quot;&quot;</span>
        <span class="n">rels</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">pots</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;metric_&quot;</span><span class="p">:</span> <span class="c1"># savefile</span>
            <span class="n">skipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RewardsSkippedLog&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rewards_skipped&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">skipped</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">skipped</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">:=</span> <span class="n">choice</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">]):</span>
                    <span class="n">rels</span><span class="p">[</span><span class="n">choice</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">r</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">:=</span> <span class="n">choice</span><span class="p">[</span><span class="s2">&quot;potions&quot;</span><span class="p">]):</span>
                    <span class="n">pots</span><span class="p">[</span><span class="n">choice</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rels</span><span class="p">,</span> <span class="n">pots</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">character</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Human-readable character name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_character</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">_chars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_character</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_character</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;The &quot;</span><span class="p">):</span> <span class="c1"># just fix it after the fact</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">c</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the run uses a modded character.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">character</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Ironclad&quot;</span><span class="p">,</span> <span class="s2">&quot;Silent&quot;</span><span class="p">,</span> <span class="s2">&quot;Defect&quot;</span><span class="p">,</span> <span class="s2">&quot;Watcher&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_hp_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The current HP in all the floors, including Neow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">current_hp</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;current_hp_per_floor&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The max HP in all the floors, including Neow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">max_hp</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;max_hp_per_floor&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gold_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The gold in all the floors, including Neow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">gold</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;gold_per_floor&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potions obtained through normal rewards or purchases.&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;potions_obtained&quot;</span><span class="p">]:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_potions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_potion_mapping</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not a valid potion action.&quot;</span><span class="p">)</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;metric_&quot;</span><span class="p">:</span> <span class="c1"># savefile</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mapkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_potion_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
        <span class="c1"># this needs RHP, so it might not be present</span>
        <span class="c1"># but we want a list anyway, which is why we iterate like this</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">):</span>
            <span class="n">potions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># it&#39;s possible the key doesn&#39;t exist, but we don&#39;t want it to error</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">[</span><span class="n">mapkey</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">potions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="c1"># Either we don&#39;t have RHP, or the floor isn&#39;t stored somehow</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">potions</span><span class="p">:</span>
                <span class="c1"># we add one here because the internal list starts at floor 1</span>
                <span class="c1"># so index 0 is floor 1, which we need to correct for here</span>
                <span class="n">final</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">potions</span>

        <span class="k">return</span> <span class="n">final</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_use</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potions that were used during the run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_potions</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_alchemize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potions that were obtained from Alchemize during the run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_potions</span><span class="p">(</span><span class="s2">&quot;alchemize&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_entropic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potions that were obtained from Entropic Brew during the run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_potions</span><span class="p">(</span><span class="s2">&quot;entropic&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions_discarded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PotionRewards</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potions that were discarded during the run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_potions</span><span class="p">(</span><span class="s2">&quot;discarded&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">boss_relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">BossRelicChoice</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Picked and skipped boss relics this run.&quot;&quot;&quot;</span>
        <span class="n">rels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">boss_relics&quot;</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">choices</span> <span class="ow">in</span> <span class="n">rels</span><span class="p">:</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;picked&quot;</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
                <span class="n">picked</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="s2">&quot;picked&quot;</span><span class="p">])</span>
            <span class="n">skipped</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">[</span><span class="s2">&quot;not_picked&quot;</span><span class="p">])</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">picked</span><span class="p">,</span> <span class="n">skipped</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ascension_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Ascension level of the run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;ascension_level&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">playtime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time between the start of the run and the latest save.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;playtime&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeysObtained</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Heart keys obtained this run.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">card_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">CardRewards</span><span class="p">,</span> <span class="n">CardRewards</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple of (picked, skipped) cards this run.&quot;&quot;&quot;</span>
        <span class="n">picked</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">skipped</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;card_choices&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">:=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;picked&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;SKIP&quot;</span><span class="p">:</span>
                <span class="n">picked</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;not_picked&quot;</span><span class="p">]:</span>
                <span class="n">skipped</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">picked</span><span class="p">,</span> <span class="n">skipped</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span> <span class="c1">#PRIV# why is this like that</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_master_deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="FileParser.get_cards">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_cards">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">CardData</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield each card with no repetition, with count.&quot;&quot;&quot;</span>
        <span class="n">master_deck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_master_deck</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">master_deck</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">CardData</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">master_deck</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileParser.get_meta_scaling_cards">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_meta_scaling_cards">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_meta_scaling_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return info about the meta-scaling cards.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All the cards in the deck, with upgrade.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cards</span><span class="p">():</span>
            <span class="k">yield from</span> <span class="n">card</span><span class="o">.</span><span class="n">as_cards</span><span class="p">()</span>

<div class="viewcode-block" id="FileParser.get_purchases">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_purchases">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_purchases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ShopContents</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping of purchases for a given floor.&quot;&quot;&quot;</span>
        <span class="n">bought</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ShopContents</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">ShopContents</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">purchased</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;item_purchase_floors&quot;</span><span class="p">]):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;items_purchased&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">upgrades</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">match</span> <span class="n">item</span><span class="o">.</span><span class="n">cls_name</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;card&quot;</span><span class="p">:</span>
                    <span class="n">bought</span><span class="p">[</span><span class="n">purchased</span><span class="p">]</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">case</span> <span class="s2">&quot;relic&quot;</span><span class="p">:</span>
                    <span class="n">bought</span><span class="p">[</span><span class="n">purchased</span><span class="p">]</span><span class="o">.</span><span class="n">add_relic</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">case</span> <span class="s2">&quot;potion&quot;</span><span class="p">:</span>
                    <span class="n">bought</span><span class="p">[</span><span class="n">purchased</span><span class="p">]</span><span class="o">.</span><span class="n">add_potion</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bought</span></div>


<div class="viewcode-block" id="FileParser.get_shop_contents">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_shop_contents">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_shop_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ShopContents</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mapping of unpurchased shop contents for a given floor.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;shop_contents&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;shop_contents&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;basemod:mod_saves&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ShopContentsLog&quot;</span><span class="p">,</span> <span class="p">())</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">ShopContents</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">ShopContents</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">relic</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">]:</span>
                <span class="n">contents</span><span class="o">.</span><span class="n">add_relic</span><span class="p">(</span><span class="n">relic</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cards&quot;</span><span class="p">]:</span>
                <span class="n">contents</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">potion</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;potions&quot;</span><span class="p">]:</span>
                <span class="n">contents</span><span class="o">.</span><span class="n">add_potion</span><span class="p">(</span><span class="n">potion</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_removals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="n">event_removals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;event_choices&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cards_removed&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">event_removals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">removed</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]))</span>

        <span class="n">store_removals</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;items_purged&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;items_purged_floors&quot;</span><span class="p">,</span> <span class="p">[]))</span>

        <span class="c1"># missing Empty Cage</span>
        <span class="n">all_removals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">cards_removed</span><span class="p">:</span>
            <span class="n">all_removals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">card</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">all_removals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">event_removals</span><span class="p">)</span>
        <span class="n">all_removals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">store_removals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_removals</span>

<div class="viewcode-block" id="FileParser.get_removals">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_removals">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_removals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">CardData</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield each removed card with no repetition, with count.&quot;&quot;&quot;</span>
        <span class="n">removals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removals</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">removals</span><span class="p">):</span> <span class="c1"># remove duplicates</span>
            <span class="k">yield</span> <span class="n">CardData</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">removals</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_removals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether we removed any card at all.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_removals</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">removals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">ItemFloor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Every (name, floor) tuple of removed card and their floor.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">card</span><span class="p">,</span> <span class="n">floor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removals</span><span class="p">:</span>
            <span class="n">cdata</span> <span class="o">=</span> <span class="n">CardData</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">cdata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">floor</span><span class="p">)</span>

<div class="viewcode-block" id="FileParser.master_deck_as_html">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.master_deck_as_html">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">master_deck_as_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the cards from the deck suitable for the website.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards_as_html</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cards</span><span class="p">())</span></div>


<div class="viewcode-block" id="FileParser.removals_as_html">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.removals_as_html">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">removals_as_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the removed cards suitable for the website.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards_as_html</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_removals</span><span class="p">())</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_cards_as_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cards</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">CardData</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;&lt;a class=&quot;card&quot;</span><span class="si">{color}</span><span class="s1"> href=&quot;https://raw.githubusercontent.com/OceanUwU/slaytabase/main/docs/</span><span class="si">{mod}</span><span class="s1">/cards/</span><span class="si">{card_url}</span><span class="s1">.png&quot; target=&quot;_blank&quot;&gt;&#39;</span>
            <span class="s1">&#39;&lt;svg width=&quot;32&quot; height=&quot;32&quot;&gt;&#39;</span>
            <span class="s1">&#39;&lt;image width=&quot;32&quot; height=&quot;32&quot; xlink:href=&quot;</span><span class="si">{website}</span><span class="s1">/static/card/Back_</span><span class="si">{card.color}</span><span class="s1">.png&quot;&gt;&lt;/image&gt;&#39;</span>
            <span class="s1">&#39;&lt;image width=&quot;32&quot; height=&quot;32&quot; xlink:href=&quot;</span><span class="si">{website}</span><span class="s1">/static/card/Desc_</span><span class="si">{card.color}</span><span class="s1">.png&quot;&gt;&lt;/image&gt;&#39;</span>
            <span class="s1">&#39;&lt;image width=&quot;32&quot; height=&quot;32&quot; xlink:href=&quot;</span><span class="si">{website}</span><span class="s1">/static/card/Type_</span><span class="si">{card.type_safe}</span><span class="s1">.png&quot;&gt;&lt;/image&gt;&#39;</span>
            <span class="s1">&#39;&lt;image width=&quot;32&quot; height=&quot;32&quot; xlink:href=&quot;</span><span class="si">{website}</span><span class="s1">/static/card/Banner_</span><span class="si">{banner}</span><span class="s1">.png&quot;&gt;&lt;/image&gt;&#39;</span>
            <span class="s1">&#39;&lt;/svg&gt;&lt;span&gt;</span><span class="si">{card.display_name}</span><span class="s1">&lt;/span&gt;&lt;/a&gt;&#39;</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">new_color</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">CardData</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Rare&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Uncommon&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;Common&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="kc">None</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Purple&quot;</span><span class="p">,</span> <span class="s2">&quot;Colorless&quot;</span><span class="p">,</span> <span class="s2">&quot;Curse&quot;</span><span class="p">]</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="n">new_color</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">cards</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
                <span class="n">order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">card</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="n">content</span><span class="p">[</span><span class="n">card</span><span class="o">.</span><span class="n">color</span><span class="p">][</span><span class="n">card</span><span class="o">.</span><span class="n">rarity_safe</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>

        <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rarity</span><span class="p">,</span> <span class="n">all_cards</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="n">color</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">all_cards</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">x</span><span class="o">.</span><span class="n">upgrades</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">all_cards</span><span class="p">:</span>
                    <span class="n">format_map</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s1">&#39; style=&quot;color:#a0ffaa&quot;&#39;</span> <span class="k">if</span> <span class="n">card</span><span class="o">.</span><span class="n">upgrades</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1"># make it green when upgraded</span>
                        <span class="s2">&quot;website&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                        <span class="s2">&quot;banner&quot;</span><span class="p">:</span> <span class="n">rarity</span> <span class="ow">or</span> <span class="s2">&quot;Common&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;mod&quot;</span><span class="p">:</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">mod</span> <span class="ow">or</span> <span class="s2">&quot;Slay the Spire&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                        <span class="s2">&quot;card_url&quot;</span><span class="p">:</span> <span class="n">format_for_slaytabase</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">internal</span><span class="p">),</span>
                        <span class="s2">&quot;card&quot;</span><span class="p">:</span> <span class="n">card</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">format_map</span><span class="p">(</span><span class="n">format_map</span><span class="p">))</span>

        <span class="n">step</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">rem</span><span class="p">:</span>
            <span class="n">end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">step</span><span class="o">*</span><span class="n">rem</span><span class="p">))</span>
            <span class="n">rem</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">end</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">final</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="n">step</span><span class="p">]</span>
        <span class="k">yield from</span> <span class="n">end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelicData</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s2">&quot;relics&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">relic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">]:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">RelicData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relic</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;relics&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics_bare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="c1"># could be a generator, but we want easy contain check</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">relic</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics_obtained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RelicRewards</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">relic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;relics_obtained&quot;</span><span class="p">]:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">relic</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">relic</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">seed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The seed being used for the pRNG in this run.&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;0123456789ABCDEFGHIJKLMNPQRSTUVWXYZ&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">])</span> <span class="c1"># might be stored as a str</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;seed_played&quot;</span><span class="p">])</span>

        <span class="c1"># this is a bit weird, but lets us convert a negative number, if any, into a positive one</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">seed</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xff</span><span class="s2">&quot;</span><span class="p">),</span> <span class="s2">&quot;big&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">num</span><span class="p">:</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">s</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># everything&#39;s backwards, for some reason... but this works</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_seeded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether a seed was manually chosen.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;seed_set&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;seed_set&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;chose_seed&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">NodeData</span><span class="p">]:</span> <span class="c1"># note: caching may not be needed</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The run&#39;s path, cached.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">floor_time</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;basemod:mod_saves&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
                <span class="n">floor_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FloorExitPlaytimeLog&quot;</span><span class="p">,</span> <span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">floor_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;floor_exit_playtime&quot;</span><span class="p">,</span> <span class="p">())</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">card_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">card_delta</span><span class="p">()</span>
            <span class="n">relic_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">relic_delta</span><span class="p">()</span>
            <span class="n">potion_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">potion_delta</span><span class="p">()</span>
            <span class="n">fights_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">fights_delta</span><span class="p">()</span>
            <span class="n">turns_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span><span class="o">.</span><span class="n">turns_delta</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">cached</span> <span class="ow">in</span> <span class="n">_get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;old_path&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">floor_time</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">floor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">cached</span><span class="p">:</span> <span class="c1"># don&#39;t recompute the deltas -- just grab their cached counts</span>
                    <span class="n">card_count</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">card_count</span>
                    <span class="n">relic_count</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">relic_count</span>
                    <span class="n">potion_count</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">potion_count</span>
                    <span class="n">fights_count</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">fights_count</span>
                    <span class="n">turns_count</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">turns_count</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">card_count</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">card_delta</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">card_count</span> <span class="o">=</span> <span class="n">card_count</span>
                    <span class="n">relic_count</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">relic_delta</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">relic_count</span> <span class="o">=</span> <span class="n">relic_count</span>
                    <span class="n">potion_count</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">potion_delta</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">potion_count</span> <span class="o">=</span> <span class="n">potion_count</span>
                    <span class="n">fights_count</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">fights_delta</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">fights_count</span> <span class="o">=</span> <span class="n">fights_count</span>
                    <span class="n">turns_count</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">turns_delta</span><span class="p">()</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">turns_count</span> <span class="o">=</span> <span class="n">turns_count</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">floor_time</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">prev</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="n">t</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;daily_mods&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifiers_with_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="n">modifiers_with_desc</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_run_mod</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">modifiers_with_desc</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">score_breakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="FileParser.get_floor">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.FileParser.get_floor">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseNode</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">floor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neow_bonus</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">floor</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">node</span>
        <span class="k">return</span> <span class="kc">None</span></div>
</div>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_nodes</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">maybe_cached</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">NodeData</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">NodeData</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span> <span class="c1">#PRIV#</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the map nodes. This should only ever be called from &#39;FileParser.path&#39; to get the cache.&quot;&quot;&quot;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">prefix</span>
    <span class="n">on_map</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;path_taken&quot;</span><span class="p">]</span>
    <span class="c1"># maybe_cached will not be None if this is a savefile we&#39;re iterating through</span>
    <span class="c1"># which means we already know previous floors, so just use that.</span>
    <span class="c1"># to be safe, regenerate the last floor, since it might have changed</span>
    <span class="c1"># (e.g. the last time we saw it, we were in-combat, and now we&#39;re out of it)</span>
    <span class="c1"># this is also used for run files for which we had the savefile</span>
    <span class="k">if</span> <span class="n">maybe_cached</span><span class="p">:</span>
        <span class="n">maybe_cached</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">taken_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;path_taken&quot;</span><span class="p">])</span>
    <span class="n">actual_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;path_per_floor&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">last_changed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">floor</span><span class="p">,</span> <span class="n">actual</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;path_per_floor&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">iterate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Slay the Streamer boss pick</span>
        <span class="k">if</span> <span class="n">actual_len</span> <span class="o">&gt;</span> <span class="n">taken_len</span> <span class="ow">and</span> <span class="n">actual</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span> <span class="ow">and</span> <span class="n">floor</span> <span class="o">==</span> <span class="n">last_changed</span> <span class="o">+</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">taken_len</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># keep track</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">iterate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># make sure we step through the iterator even if it&#39;s cached</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">[</span><span class="n">actual</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">iterate</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_map</span><span class="p">[</span><span class="n">floor</span><span class="o">-</span><span class="n">offset</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">iterate</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">maybe_cached</span><span class="p">:</span>
            <span class="n">maybe_node</span> <span class="o">=</span> <span class="n">maybe_cached</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">floor</span> <span class="o">==</span> <span class="n">maybe_node</span><span class="o">.</span><span class="n">floor</span><span class="p">:</span> <span class="c1"># if it&#39;s not, then something&#39;s wrong. just regen it</span>
                <span class="k">yield</span> <span class="n">maybe_node</span><span class="p">,</span> <span class="kc">True</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">iterate</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">match</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">NormalEncounter</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">EventEncounter</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">EliteEncounter</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span> <span class="c1"># only happens if the Deadly Events modifier is on</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">EventElite</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;$&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Merchant</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">EventMerchant</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Treasure</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">EventTreasure</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">event_node</span> <span class="c1"># not actually a NodeData subclass, but it returns one</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Campfire</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;BOSS&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Boss</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Courier</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Empty</span>
            <span class="k">case</span> <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">):</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">SWF</span>
            <span class="k">case</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">floor</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span> <span class="c1"># kind of a hack for the first two acts</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">BossChest</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;max_hp_per_floor&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">floor</span><span class="p">:</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">Victory</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">Act4Transition</span>
            <span class="k">case</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: the combination of map node </span><span class="si">{</span><span class="n">b</span><span class="si">!r}</span><span class="s2"> and content </span><span class="si">{</span><span class="n">a</span><span class="si">!r}</span><span class="s2"> is undefined (run: </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;savefile&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">end_of_act</span><span class="p">:</span>
            <span class="n">last_changed</span> <span class="o">=</span> <span class="n">floor</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span><span class="p">:</span> <span class="n">NodeData</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c1"># this can happen for savefiles if we&#39;re on the latest floor</span>
            <span class="k">if</span> <span class="n">taken_len</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># we&#39;re on the last floor</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">value</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actual: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;4</span><span class="si">}</span><span class="s2"> | Map: </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">))</span>

<span class="k">class</span><span class="w"> </span><span class="nc">KeysObtained</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contain information about the obtained keys.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ruby_key_obtained</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ruby_key_floor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emerald_key_obtained</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emerald_key_floor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sapphire_key_obtained</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sapphire_key_floor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Emerald Key&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emerald_key_obtained</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emerald_key_floor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Ruby Key&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ruby_key_obtained</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ruby_key_floor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Sapphire Key&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sapphire_key_obtained</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sapphire_key_floor</span><span class="p">),</span>
        <span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RelicData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contain information for Spire relics.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">relic</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="p">:</span> <span class="n">Relic</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">relic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">obtained</span><span class="p">:</span> <span class="n">BaseNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">neow_bonus</span>
            <span class="n">node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
                    <span class="n">obtained</span> <span class="o">=</span> <span class="n">node</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Obtained on floor </span><span class="si">{</span><span class="n">obtained</span><span class="o">.</span><span class="n">floor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_details</span><span class="p">(</span><span class="n">obtained</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span> <span class="c1"># node will be the last node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">escaped_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#PRIV#</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the relic&#39;s raw stats for this run.</span>

<span class="sd">        :return: The matching stats, or None if not present.</span>
<span class="sd">        :rtype: int | float | str | list[str] | None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;basemod:mod_saves&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stats_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">internal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;relic_stats&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;relic_stats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">internal</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obtained</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">last</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseNode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get stats information for this relic.</span>

<span class="sd">        :param obtained: The node this relic was obtained, defaults to None.</span>
<span class="sd">        :type obtained: BaseNode, optional</span>
<span class="sd">        :param last: The current or last node, defaults to None.</span>
<span class="sd">        :type last: BaseNode, optional</span>
<span class="sd">        :return: A list of this relic&#39;s stats.</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">get_relic_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">internal</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># no stats for these</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># we want to support calling this method without any argument</span>
        <span class="c1"># in which case we just won&#39;t have per-turn data</span>
        <span class="n">per_turn</span> <span class="o">=</span> <span class="p">(</span><span class="n">obtained</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;White Beast Statue&quot;</span><span class="p">:</span>
            <span class="c1"># if this is a savefile, only the last number matters. run files should be unaffected</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Snecko Eye&quot;</span><span class="p">:</span>
            <span class="c1"># special handling for this</span>
            <span class="n">per_turn</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">:=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stats</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stats</span><span class="p">))</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span> <span class="c1"># only Frozen Eye</span>
            <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">minutes</span><span class="p">:</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">m </span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># bottles</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">get</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">:</span> <span class="c1"># e.g. Whetstone upgrading nothing</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;nothing&gt;&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">]</span>
                <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">- &quot;</span><span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">- &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stats</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                    <span class="n">stat_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                        <span class="n">stat_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">text_iter</span><span class="p">)</span> <span class="o">+</span> <span class="n">stat_str</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">per_turn</span><span class="p">:</span>
                        <span class="n">num</span> <span class="o">=</span> <span class="n">stat</span> <span class="o">/</span> <span class="nb">max</span><span class="p">((</span><span class="n">last</span><span class="o">.</span><span class="n">turns_count</span> <span class="o">-</span> <span class="n">obtained</span><span class="o">.</span><span class="n">turns_count</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Per turn: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">num</span> <span class="o">=</span> <span class="n">stat</span> <span class="o">/</span> <span class="nb">max</span><span class="p">((</span><span class="n">last</span><span class="o">.</span><span class="n">fights_count</span> <span class="o">-</span> <span class="n">obtained</span><span class="o">.</span><span class="n">fights_count</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Per combat: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to parse stats for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">desc</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mod</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">mod</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Slay the Spire&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">mod</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">internal</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">format_for_slaytabase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2">.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relic</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CardData</span><span class="p">:</span> <span class="c1"># TODO: metadata + scaling cards (for savefile)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">SingleCard</span><span class="p">,</span> <span class="n">cards_list</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">meta</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig</span> <span class="o">=</span> <span class="n">card</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">card</span> <span class="o">=</span> <span class="n">get_card</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cards_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cards_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single</span> <span class="o">=</span> <span class="n">card</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="p">:</span> <span class="n">Card</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">card</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upgrades</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">upgrades</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">as_cards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">color</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">type_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Attack&quot;</span><span class="p">,</span> <span class="s2">&quot;Skill&quot;</span><span class="p">,</span> <span class="s2">&quot;Power&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;Skill&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rarity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">rarity</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rarity_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Rare&quot;</span><span class="p">,</span> <span class="s2">&quot;Uncommon&quot;</span><span class="p">,</span> <span class="s2">&quot;Common&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rarity</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards_list</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="c1"># support standalone card stuff</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">upgrades</span><span class="p">:</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">name</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">+&quot;</span>
            <span class="k">case</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">x </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<div class="viewcode-block" id="NodeData">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NodeData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NodeData</span><span class="p">(</span><span class="n">BaseNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contain relevant information for Spire nodes.</span>

<span class="sd">    To instantiate a subclass, call the class with a :class:`FileParser` instance</span>
<span class="sd">    (either :class:`src.runs.RunParser` or :class:`src.save.Savefile`) and the floor number.</span>

<span class="sd">    To change behaviour, you need to subclass the relevant subclass and alter</span>
<span class="sd">    the behaviour there. Some features rely on objects being instances of</span>
<span class="sd">    specific NodeData subclasses (e.g. :class:`Treasure`) and will fail otherwise.</span>
<span class="sd">    There is no mechanism currently for overriding which subclasses are</span>
<span class="sd">    returned by the node path parser.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1">#: The map icon as present under the static/icons/ folder</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span> <span class="c1"># TODO: Keep track of the deck per node</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a NodeData instance from a parser and floor number.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">room_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_icon</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot create NodeData subclass </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floor</span> <span class="o">=</span> <span class="n">floor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_hp_gold</span><span class="p">(</span><span class="n">floor</span><span class="p">):</span>
            <span class="c1"># in case our current floor doesn&#39;t have data, get previous floor</span>
            <span class="c1"># this can happen with the post-Heart victory screen</span>
            <span class="c1"># and also maybe during an ongoing run while getting the current node</span>
            <span class="c1"># if this assignment fails too, just let it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_hp_gold</span><span class="p">(</span><span class="n">floor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_hp_gold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the gold as well as current and max HP for this node.</span>
<span class="sd">        </span>
<span class="sd">        Return True if assignment succeeded, False otherwise.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># delay assignment in case a later one fails</span>
            <span class="c1"># we don&#39;t want some of them to be assigned and others not</span>
            <span class="n">cur_hp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">current_hp_counts</span><span class="p">[</span><span class="n">floor</span><span class="p">]</span>
            <span class="n">max_hp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">max_hp_counts</span><span class="p">[</span><span class="n">floor</span><span class="p">]</span>
            <span class="n">gold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">gold_counts</span><span class="p">[</span><span class="n">floor</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_hp</span> <span class="o">=</span> <span class="n">cur_hp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_hp</span> <span class="o">=</span> <span class="n">max_hp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gold</span> <span class="o">=</span> <span class="n">gold</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="NodeData.description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NodeData.description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;description&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="NodeData.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NodeData.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions obtained:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_potions</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions used:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_potions</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_alchemize</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions obtained from Alchemize:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_alchemize</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_entropic</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions obtained from Entropic Brew:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potions_from_entropic</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discarded_potions</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions discarded:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discarded_potions</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_potions</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Potions skipped:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_potions</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Relics obtained:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relics</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_relics</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Relics skipped:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped_relics</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Picked:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">picked</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Skipped:&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipped</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EncounterBase">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EncounterBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EncounterBase</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A base data class for Spire node encounters.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">damage</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">parser</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;damage_taken&quot;</span><span class="p">]:</span> <span class="c1">#PRIV#</span>
            <span class="k">if</span> <span class="n">damage</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no fight result yet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_damage</span> <span class="o">=</span> <span class="n">damage</span>

<div class="viewcode-block" id="EncounterBase.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EncounterBase.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fought</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fought </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fought</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="si">}</span><span class="s2"> damage&quot;</span><span class="p">)</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">turns_delta</span><span class="p">()</span><span class="si">}</span><span class="s2"> turns&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EncounterBase.fights_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EncounterBase.fights_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fights_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="EncounterBase.turns_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EncounterBase.turns_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">turns_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_damage</span><span class="p">[</span><span class="s2">&quot;turns&quot;</span><span class="p">])</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">enemies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_damage</span><span class="p">[</span><span class="s2">&quot;enemies&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_enemies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">enemies</span><span class="p">,</span> <span class="n">enemies</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fought</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A human-readable name of the battle fought this floor.&quot;&quot;&quot;</span>
        <span class="n">fought</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_damage</span><span class="p">[</span><span class="s2">&quot;enemies&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_enemies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fought</span><span class="p">,</span> <span class="n">fought</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much damage was taken this fight.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_damage</span><span class="p">[</span><span class="s2">&quot;damage&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="NormalEncounter">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.NormalEncounter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NormalEncounter</span><span class="p">(</span><span class="n">EncounterBase</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Enemy&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;fight_normal.png&quot;</span></div>


<div class="viewcode-block" id="EventEncounter">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EventEncounter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventEncounter</span><span class="p">(</span><span class="n">EncounterBase</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Enemy)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event_fight.png&quot;</span></div>


<div class="viewcode-block" id="Treasure">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Treasure">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Treasure</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Treasure&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;treasure_chest.png&quot;</span>

    <span class="n">key_relic</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Relic</span><span class="p">]</span> <span class="c1">#: The relic that was skipped for the Sapphire Key on this floor, if any.</span>
    <span class="n">blue_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="c1">#: Whether we acquired the Sapphire Key on this floor.</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_relic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relic</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blue_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_relic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_relic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span> <span class="c1">#PRIV#</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">if</span> <span class="s2">&quot;BlueKeyRelicSkippedLog&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;BlueKeyRelicSkippedLog&quot;</span><span class="p">][</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;BlueKeyRelicSkippedLog&quot;</span><span class="p">][</span><span class="s2">&quot;relicID&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="s2">&quot;blue_key_relic_skipped_log&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;blue_key_relic_skipped_log&quot;</span><span class="p">][</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;blue_key_relic_skipped_log&quot;</span><span class="p">][</span><span class="s2">&quot;relicID&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="Treasure.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Treasure.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blue_key</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key_relic</span><span class="si">}</span><span class="s2"> for the Sapphire key&quot;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EventTreasure">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EventTreasure">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventTreasure</span><span class="p">(</span><span class="n">Treasure</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Treasure)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event_chest.png&quot;</span></div>


<div class="viewcode-block" id="EliteEncounter">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EliteEncounter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EliteEncounter</span><span class="p">(</span><span class="n">EncounterBase</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Elite&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;fight_elite.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;basemod:mod_saves&quot;</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="n">key_floor</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;basemod:mod_saves&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;greenKeyTakenLog&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_floor</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;green_key_taken_log&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key_floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">key_floor</span><span class="p">)</span> <span class="o">==</span> <span class="n">floor</span><span class="p">)</span>

<div class="viewcode-block" id="EliteEncounter.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EliteEncounter.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_key</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Got the Emerald Key&quot;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EventElite">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EventElite">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventElite</span><span class="p">(</span><span class="n">EliteEncounter</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Elite)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">event_node</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseNode</span><span class="p">:</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">parser</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;event_choices&quot;</span><span class="p">]:</span> <span class="c1">#PRIV#</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
            <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EmptyEvent</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Colosseum&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Colosseum</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span> <span class="c1"># I&#39;m not quite sure how this happens, but sometimes an event will be in twice?</span>
                    <span class="k">return</span> <span class="n">AmbiguousEvent</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dmg</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">parser</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;damage_taken&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">dmg</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span> <span class="c1"># not passing dmg in, as EncounterBase fills it in</span>
            <span class="k">return</span> <span class="n">EventFight</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Event</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>

<span class="n">event_node</span><span class="o">.</span><span class="n">end_of_act</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EmptyEvent</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Bugged)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;Something happened here, but I&#39;m not sure what...</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;This is a bug with a mod. Please report this to the mod creators:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&#39;Missing event data in JSON&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;(Provide the event name if you can find it)&quot;</span>
        <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AmbiguousEvent</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Ambiguous)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_events</span> <span class="o">=</span> <span class="n">events</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;This event is ambiguous; multiple events map to it:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_events</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; -</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;This is a bug with a mod. Please report this to the mod creators.&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Event">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Event">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event</span> <span class="o">=</span> <span class="n">event</span>

<div class="viewcode-block" id="Event.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Event.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="n">EventFight</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">to_append</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Option taken:</span><span class="se">\n</span><span class="s2">- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">choice</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">42</span>   <span class="c1">#       42               44              46               48           50             52</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;damage_healed&quot;</span><span class="p">,</span> <span class="s2">&quot;damage_taken&quot;</span><span class="p">,</span> <span class="s2">&quot;max_hp_gained&quot;</span><span class="p">,</span> <span class="s2">&quot;max_hp_lost&quot;</span><span class="p">,</span> <span class="s2">&quot;gold_gained&quot;</span><span class="p">,</span> <span class="s2">&quot;gold_lost&quot;</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;HP&quot;</span><span class="p">)</span>
                <span class="n">to_append</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#               54                   56                58               60                 62</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;cards_transformed&quot;</span><span class="p">,</span> <span class="s2">&quot;cards_obtained&quot;</span><span class="p">,</span> <span class="s2">&quot;cards_removed&quot;</span><span class="p">,</span> <span class="s2">&quot;cards_upgraded&quot;</span><span class="p">,</span> <span class="s2">&quot;relics_lost&quot;</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="n">to_append</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                <span class="n">to_append</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">card</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="Event.potion_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Event.potion_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">potion_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">potion_delta</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WeMeetAgain&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice</span> <span class="o">==</span> <span class="s2">&quot;Gave Potion&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">value</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;event_name&quot;</span><span class="p">])</span>

    <span class="c1"># TODO: Move all/most of these to the base class?</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">choice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Which option was picked for this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;player_choice&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_healed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much health was gained during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;damage_healed&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_taken</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much health was lost during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;damage_taken&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp_gained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much max HP was gained during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;max_hp_gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_hp_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much max HP was lost during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;max_hp_loss&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gold_gained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much gold was gained during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;gold_gain&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gold_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much gold was lost during this event.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="p">[</span><span class="s2">&quot;gold_loss&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_transformed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_transformed</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cards_transformed&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_obtained</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_obtained</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cards_obtained&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_removed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_removed</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cards_removed&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cards_upgraded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SingleCard</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cards_upgraded</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cards_upgraded&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_card</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">relics</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relics_obtained&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">relics_lost</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relics_lost&quot;</span><span class="p">,</span> <span class="p">()):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">l</span></div>


<div class="viewcode-block" id="EventFight">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EventFight">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventFight</span><span class="p">(</span><span class="n">Event</span><span class="p">,</span> <span class="n">EncounterBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a subclass for fights that happen in events.</span>

<span class="sd">    This works for Dead Adventurer, Masked Bandits, etc.</span>
<span class="sd">    This does *not* work for the Colosseum fight (use :class:`Colosseum` instead)</span>

<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Colosseum">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Colosseum">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Colosseum</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;damage_healed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;gold_gain&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;player_choice&quot;</span><span class="p">:</span> <span class="s2">&quot;Fought Taskmaster + Nob&quot;</span><span class="p">,</span>
            <span class="s2">&quot;damage_taken&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;max_hp_gain&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;max_hp_loss&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;event_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Colosseum&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gold_loss&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">event</span><span class="p">[</span><span class="s2">&quot;player_choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Escaped&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="n">dmg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">damage</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">parser</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;damage_taken&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">damage</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
                <span class="n">dmg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">damage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_damages</span> <span class="o">=</span> <span class="n">dmg</span>

<div class="viewcode-block" id="Colosseum.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Colosseum.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dmg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_damages</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fight </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">dmg</span><span class="p">[</span><span class="s1">&#39;enemies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dmg</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> damage&quot;</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dmg</span><span class="p">[</span><span class="s1">&#39;turns&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> turns&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How much damage was taken over both fights, if relevant.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;damage&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_damages</span><span class="p">)</span>

<div class="viewcode-block" id="Colosseum.fights_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Colosseum.fights_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fights_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_damages</span><span class="p">)</span></div>


<div class="viewcode-block" id="Colosseum.turns_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Colosseum.turns_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">turns_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;turns&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_damages</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="Merchant">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Merchant">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Merchant</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Merchant&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;shop.png&quot;</span>

    <span class="n">contents</span><span class="p">:</span> <span class="n">ShopContents</span> <span class="c1">#: The non-purchased contents of the shop.</span>
    <span class="n">bought</span><span class="p">:</span> <span class="n">ShopContents</span> <span class="c1">#: All purchased goods from this shop.</span>
    <span class="n">purged</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="c1">#: All cards removed this floor.</span>

    <span class="c1"># XXX: should purged be a SingleCard?</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_shop_contents</span><span class="p">()[</span><span class="n">floor</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bought</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_purchases</span><span class="p">()[</span><span class="n">floor</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purged</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">card</span><span class="p">,</span> <span class="n">floor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">removals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">floor</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">floor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">purged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>

<div class="viewcode-block" id="Merchant.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Merchant.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">purged</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">70</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;* Removed </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">purged</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">72</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Skipped:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">relics</span><span class="p">:</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">74</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* Relics&quot;</span><span class="p">)</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">74</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">relics</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">cards</span><span class="p">:</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">76</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* Cards&quot;</span><span class="p">)</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">76</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">cards</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">potions</span><span class="p">:</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">78</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;* Potions&quot;</span><span class="p">)</span>
                <span class="n">to_append</span><span class="p">[</span><span class="mi">78</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">potions</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">picked</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">picked</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bought</span><span class="o">.</span><span class="n">cards</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">relics</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bought</span><span class="o">.</span><span class="n">relics</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">potions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Potion</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">potions</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bought</span><span class="o">.</span><span class="n">potions</span>

<div class="viewcode-block" id="Merchant.card_delta">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Merchant.card_delta">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">card_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">card_delta</span><span class="p">()</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">purged</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EventMerchant">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.EventMerchant">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EventMerchant</span><span class="p">(</span><span class="n">Merchant</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown (Merchant)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event_shop.png&quot;</span></div>


<span class="k">class</span><span class="w"> </span><span class="nc">Courier</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Courier (Spire with Friends)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;This is a Courier node. I don&#39;t know how to deal with it.&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Empty</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Empty (Spire with Friends)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="p">:</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;This is an empty node. Nothing happened here.&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SWF</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Unknown Node (Spire with Friends)&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;This is some Spire with Friends stuff. I don&#39;t know how to deal with it.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Campfire">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Campfire">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Campfire</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Rest Site&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;rest.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">parser</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;campfire_choices&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rest</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">floor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Campfire.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Campfire.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">to_append</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Human-readable string of the action taken on this floor.&quot;&quot;&quot;</span>
        <span class="k">match</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;REST&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Rested&quot;</span>
            <span class="k">case</span> <span class="s2">&quot;RECALL&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Got the Ruby key&quot;</span>
            <span class="k">case</span> <span class="s2">&quot;SMITH&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Upgraded </span><span class="si">{</span><span class="n">get_card</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">case</span> <span class="s2">&quot;LIFT&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Lifted for additional strength (Total: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">case</span> <span class="s2">&quot;DIG&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Dug!&quot;</span>
            <span class="k">case</span> <span class="s2">&quot;PURGE&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Toked </span><span class="si">{</span><span class="n">get_card</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">case</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Did </span><span class="si">{</span><span class="n">a</span><span class="si">!r}</span><span class="s2"> with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="si">!r}</span><span class="s2">, but I&#39;m not sure what this means&quot;</span></div>


<div class="viewcode-block" id="Boss">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Boss">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Boss</span><span class="p">(</span><span class="n">EncounterBase</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Boss&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;boss_node.png&quot;</span></div>


<div class="viewcode-block" id="BossChest">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.BossChest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BossChest</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Boss Chest&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;boss_chest.png&quot;</span>
    <span class="n">end_of_act</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="n">boss_relics</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_get_boss_chest</span><span class="p">()</span>
        <span class="n">picked</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">skipped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">boss_relics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;picked&quot;</span><span class="p">,</span> <span class="s2">&quot;SKIP&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;SKIP&quot;</span><span class="p">:</span>
            <span class="n">picked</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">boss_relics</span><span class="p">[</span><span class="s2">&quot;picked&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">relic</span> <span class="ow">in</span> <span class="n">boss_relics</span><span class="p">[</span><span class="s2">&quot;not_picked&quot;</span><span class="p">]:</span>
            <span class="n">skipped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">relic</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_picked</span> <span class="o">=</span> <span class="n">picked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skipped</span> <span class="o">=</span> <span class="n">skipped</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_picked</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_picked</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">skipped_relics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Relic</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipped</span></div>


<div class="viewcode-block" id="Act4Transition">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Act4Transition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Act4Transition</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Transition into Act 4&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>
    <span class="n">end_of_act</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Victory">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Victory">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Victory</span><span class="p">(</span><span class="n">NodeData</span><span class="p">):</span>
    <span class="n">room_type</span> <span class="o">=</span> <span class="s2">&quot;Victory!&quot;</span>
    <span class="n">map_icon</span> <span class="o">=</span> <span class="s2">&quot;event.png&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">FileParser</span><span class="p">,</span> <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="o">*</span><span class="n">extra</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_score</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score_breakdown&quot;</span><span class="p">,</span> <span class="p">[])</span>

<div class="viewcode-block" id="Victory.get_description">
<a class="viewcode-back" href="../../nodes.html#src.gamedata.Victory.get_description">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_append</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">:</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_breakdown</span><span class="p">)</span>
            <span class="n">to_append</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Score: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;How many points we got this run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">score_breakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Human-readable breakdown of the score.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>


<div class="viewcode-block" id="BottleRelic">
<a class="viewcode-back" href="../../fileparser.html#src.gamedata.BottleRelic">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BottleRelic</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">bottle_id</span><span class="p">:</span> <span class="nb">str</span> <span class="c1">#: The name of the bottle.</span>
    <span class="n">card</span><span class="p">:</span> <span class="n">SingleCard</span> <span class="c1">#: The card which is bottled.</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022-2025, Anilyka Barry, Olivia Thiderman, Spireblight Development Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>